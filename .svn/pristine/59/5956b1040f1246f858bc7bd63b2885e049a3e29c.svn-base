<%@ Page Title="" Language="C#" MasterPageFile="~/MasterPages/Main.Master" AutoEventWireup="true" CodeBehind="CheckoutShipping.aspx.cs" Inherits="TweebaaWebApp2.Product.CheckoutShipping" %>
<asp:Content ID="Content1" ContentPlaceHolderID="WebTitle" runat="server">
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="WebCssAndJs" runat="server">

    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico">

    <!-- CSS Global Compulsory -->
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/shop.style.css">
     
    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="/plugins/line-icons/line-icons.css">
    <link rel="stylesheet" href="/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/plugins/scrollbar/src/perfect-scrollbar.css">
    <link rel="stylesheet" href="/plugins/jquery-steps/css/custom-jquery.steps.css">

   <!-- <link rel="stylesheet" href="plugins/sky-forms/version-2.0.1/css/sky-forms.css"> -->
    <link rel="stylesheet" href="/css/pages/log-reg-v3.css">  
    <!-- Style Switcher -->
    <link rel="stylesheet" href="/css/plugins/style-switcher.css">

    <!-- CSS Theme -->
    <link rel="stylesheet" href="/css/theme-colors/default.css" id="style_color">

    <!-- CSS Customization -->
    <link rel="stylesheet" href="/css/custom.css">


     <script src="../MethodJs/calculate.js" type="text/javascript"></script>
    <script src="../MethodJs/buy.js" type="text/javascript"></script>

    <script src="/MethodJs/userAddress.js?v=151203" type="text/javascript"></script>
    <script src="/MethodJs/calculate.js" type="text/javascript"></script>

    <script src="/MethodJs/ExtraShipping.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/Css/mycart-new.css" />
    <style>
     #divShipping .invalid, #divBilling .invalid{ color: #8a1f11;
        font-weight: 400;
        border: 1px solid #eec5c7 !important;
        -webkit-transition: all 0.3s ease-in-out;
        -moz-transition: all 0.3s ease-in-out;
        -o-transition: all 0.3s ease-in-out;
        transition: all 0.3s ease-in-out;
    }
    </style>
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="WebContent" runat="server">

<input type="hidden" id="hid_addrCity" />
<input type="hidden" id="hid_addrZip" />
<input type="hidden" id="hid_address1" />
<input type="hidden" id="hid_address2" />
<input type="hidden" id="hid_fistname" />
<input type="hidden" id="hid_lastname" />
<input type="hidden" id="hid_phone" />
<input type="hidden" id="hid_email" />
<input type="hidden" id="hid_countryID" />
<input type="hidden" id="hid_stateID" />
           <!--=== Breadcrumbs ===-->
    <div class="breadcrumbs">
        <div class="container">
            <h1 class="pull-left">Delivery</h1>
            <ul class="pull-right breadcrumb">
                <li><a href="/index.aspx">Home</a></li>
                <li><a href="#">Product</a></li>
                <li class="active">Delivery</li>
            </ul>
        </div><!--/container-->
    </div><!--/breadcrumbs-->
    <!--=== End Breadcrumbs ===-->

         <!--=== Content Medium Part ===-->
    <div class="content margin-bottom-30">
        <div class="container"> 
        <div class="col-md-12">

<div role="application" class="wizard clearfix" id="steps-uid-0">
<div class="steps clearfix"><ul role="tablist">
<li role="tab" class="first done" aria-disabled="false" ><a id="steps-uid-0-t-0" href="javascript:void(0)"  aria-controls="steps-uid-0-p-0"><span class="current-info audible">current step: </span><span class="number">1.</span> 
                     <div class="overflow-h">
                            <h2>Shopping Cart</h2>
                          <i class="fa fa-shopping-cart"></i>
                        </div>    
                    </a></li><li role="tab" class="current" aria-disabled="true" aria-selected="true"><a id="steps-uid-0-t-1" href="javascript:void(0)"  aria-controls="steps-uid-0-p-1"><span class="number">2.</span> 
                     <div class="overflow-h">
                            <h2>Address</h2>
                          <i class="fa fa-map-marker"></i>
                        </div>    
                    </a></li><li role="tab" class="disabled" aria-disabled="true"><a id="steps-uid-0-t-2" href="javascript:void(0)"  aria-controls="steps-uid-0-p-2"><span class="number">3.</span> 
                        <div class="overflow-h">
                        <i class="fa fa-truck"></i>
                            <h2>Confirmation</h2>
                           
                        
                        </div>    
                    </a></li><li role="tab" class="disabled last" aria-disabled="true"><a id="steps-uid-0-t-3" href="javascript:void(0)"  aria-controls="steps-uid-0-p-3"><span class="number">4.</span> 
                        <div class="overflow-h">
                            <h2>Payment</h2>
                            <i class="fa fa-money"></i>
                        </div>    
                    </a></li></ul></div>
</div>

            <form class="shopping-cart" id="frmCheckoutShipping" action="/Product/CheckoutConfirmation.aspx" method="post">
                <div style="padding:20px 0px;">


                    <section class="billing-info">
                        <div class="row">
                            <div class="col-md-6 md-margin-bottom-40">
                                <h2 class="title-type">Shipping Address</h2>
                                <input type="hidden" id="hidAddressId" name="hidAddressId" />
                                <div class="billing-info-inputs checkbox-list" >
                                 <div class="shop-address" id="divShipping">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input id="txtShipName" type="text" placeholder="First Name" name="firstname" class="form-control required">
                                            <input id="txtShipEmail" type="text" placeholder="Email" name="email" class="form-control required email">
                                        </div>
                                        <div class="col-sm-6">
                                            <input id="txtShipLastName"  type="text" placeholder="Last Name" name="lastname" class="form-control required">
                                            <input id="txtShipPhone"  type="tel" placeholder="Phone" name="phone" class="form-control required">
                                        </div>
                                    </div>
                                    <input id="txtShipAddress" type="text" placeholder="Address Line 1" name="address1" class="form-control required">
                                    <input id="txtShipAddress2" type="text" placeholder="Address Line 2" name="address2" class="form-control required">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input id="txtShipCity" type="text" placeholder="City" name="city" class="form-control required">
                                        </div>
                                        <div class="col-sm-6">
                                            <input id="txtShipZip"  type="text" placeholder="Zip/Postal Code" name="zip" class="form-control required">
                                        </div>
                                    </div>
                                  <div class="row">
                                    <div class="col-sm-6">
                                    <select name="selectCountry" id="selectCountry" class="form-control"  style="width: 150px;">
                                    </select>
                                    </div>
                                    <div class="col-sm-6">
                                        <select name="selectProvince" id="selectProvince" class="form-control" style="width: 150px;">
                                    </select>
                                    </div>
                                   </div>

                                     <div class="row" style="padding-top:15px;">
                                    <div class="col-sm-6">
                                    <label class="checkbox text-left">
                                        <input type="checkbox" class="checkbox" id="ckbDefault" checked="checked" />
                                        <i></i>
                                        Set as Default
                                    </label>
                                    </div>
                                    <div class="col-sm-6">
                                   
                            <input type="button" value="Save" id="btnSaveDeliveryAddr" class="btn btn-default form-control" onclick="SaveDeliveryAddress()" />
                         
                                    </div>
                                    </div>
           

                            </div>

<!-- shop address -->


       <div class="saved-address" >
                <%--<div class="header-tags">
                    <div class="overflow-h">
                        <h2>
                            Shopping Cart</h2>
                        <p>
                            Review &amp; edit your product</p>
                        <i class="rounded-x fa fa-check"></i>
                    </div>
                </div>--%>
                <!--
                <div class="title clearfix" style="text-align: left; padding-bottom: 0px; padding-top: 0px;">
                    <h2 class="t">
                        Delivery address
                    </h2>
                </div> -->

                <section class="billing-info">
                      <p id="pAddress">
                <%--Jun cao<br />
                1800 Edmund ave,<br />
                toronto, Ontario, M3N2S5<br />
                Canada<br />
                Phone: 416229999<br />
                Email: cjunjun@gmail.com--%>
                <label id="labName">
                </label>
                <br />
                <label id="labAddress">
                </label>
                <br />
                <label id="labCountry">
                </label>
                <br />
                <label id="labCountryID" style="display: none"></label>
                <label id="labProvinceID" style="display: none"></label>
                Zip: <label id="labZip"></label>
                <br />
                Phone: <label id="labPhone"></label>
                <br />
                Email: <label id="labEmail"></label>
            </p>

            <input type="button" value="Change" class="btn btn-default" onclick="change()" />
            <script type="text/javascript">
                function change() {
                    $(".saved-address").hide();
                    $(".shop-address").show();
                }
                //                $(function () {
                //                    var _displaySaved="<%=_displaySaved %>";                    
                //                    if (_displaySaved=="none") {
                //                        $(".saved-address").hide();
                //                        $(".shop-address").show();
                //                    }
                //                    else {
                //                        $(".saved-address").show();
                //                        $(".shop-address").hide();
                //                 }
                //                 
                //                });
            
            </script>
            <!--
                      <div class="row">
                            <div class="col-md-6 md-margin-bottom-40">
                                <h2 class="title-type">Billing Address</h2>
                                <div class="billing-info-inputs checkbox-list">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input id="txtName" type="text" placeholder="First Name" name="firstname" class="form-control required" />
                                            <input id="txtEmail" type="text" placeholder="Email" name="email" class="form-control required email" />
                                        </div>
                                        <div class="col-sm-6">
                                            <input id="txtLastName" type="text" placeholder="Last Name" name="lastname" class="form-control required" />
                                            <input id="txtPhone" type="tel" placeholder="Phone" name="phone" class="form-control required" />
                                        </div>
                                    </div>
                                    <input id="txtAddress"  type="text" placeholder="Address Line 1" name="address1" class="form-control required" />
                                    <input id="txtAddress2" type="text" placeholder="Address Line 2" name="address2" class="form-control required" />
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input id="txtCity" type="text" placeholder="City" name="city" class="form-control required" />
                                        </div>
                                        <div class="col-sm-6">
                                            <input id="txtZip" type="text" placeholder="Zip/Postal Code" name="zip" class="form-control required" />
                                        </div>
                                    </div>
                                    
                                    <label class="checkbox text-left">
                                        <input type="checkbox" name="checkbox"/>
                                        <i></i>
                                        Ship item to the above billing address
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-6" style="display:none;">
                                <h2 class="title-type">Shipping Address</h2>
                                <div class="billing-info-inputs checkbox-list">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input id="Text1" type="text" placeholder="First Name" name="firstname" class="form-control">
                                            <input id="Text2" type="text" placeholder="Email" name="email" class="form-control email">
                                        </div>
                                        <div class="col-sm-6">
                                            <input id="Text3" type="text" placeholder="Last Name" name="lastname" class="form-control">
                                            <input id="Tel1" type="tel" placeholder="Phone" name="phone" class="form-control">
                                        </div>
                                    </div>
                                    <input id="Text4" type="text" placeholder="Address Line 1" name="address1" class="form-control">
                                    <input id="Text5" type="text" placeholder="Address Line 2" name="address2" class="form-control">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input id="Text6" type="text" placeholder="City" name="city" class="form-control">
                                        </div>
                                        <div class="col-sm-6">
                                            <input id="Text7" type="text" placeholder="Zip/Postal Code" name="zip" class="form-control">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>    -->   
                </section>
                
                </div>

                                </div>
                            </div>

                            <div class="col-md-6" id="divBilling">
                            <div class="row">
                                        <div class="col-sm-6">
                                <h2 class="title-type">Billing Address</h2> </div>
                                <div class="col-sm-6">
                                                                    <label class="checkbox text-left">
                                        <input type="checkbox" name="checkbox" id="cbFillBilling" onclick="Fill_BillingAddress()"/>
                                        <i></i>
                                        Use my shipping address
                                    </label></div>
                                    </div>
                                <div class="billing-info-inputs checkbox-list">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input  type="text" placeholder="First Name" id="billing_firstname" name="billing_firstname" class="form-control">
                                            <input  type="text" placeholder="Email" id="billing_email" name="billing_email" class="form-control email">
                                        </div>
                                        <div class="col-sm-6">
                                            <input  type="text" placeholder="Last Name" id="billing_lastname" name="billing_lastname" class="form-control">
                                            <input  type="tel" placeholder="Phone" id="billing_phone" name="billing_phone" class="form-control">
                                        </div>
                                    </div>
                                    <input  type="text" placeholder="Address Line 1" id="billing_address1" name="billing_address1" class="form-control">
                                    <input  type="text" placeholder="Address Line 2" id="billing_address2" name="billing_address2" class="form-control">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input id="billing_city" type="text" placeholder="City" name="billing_city" class="form-control">
                                        </div>

                                        <div class="col-sm-6">
                                            <input id="billing_zip" type="text" placeholder="Zip/Postal Code" name="billing_zip" class="form-control">
                                        </div>
                                    </div>
                                    <div class="row">
                                    <div class="col-sm-6">
                                    <select name="billing_country" class="form-control" id="billing_country" style="width: 150px;">
                                    </select>
                                    </div>
                                    <div class="col-sm-6">
                                        <select name="billing_state" class="form-control" id="billing_state" style="width: 150px;">
                                    </select>
                                    </div>
                                    <!--
                                    <table>
                                      <tr>
                        <td class="t">
                            Country<span class="h">*</span>
                        </td>
                        <td>
                            <div class="clearfix" style="float: left;">
                                <div class="selectBox pr fl">
                                    
                                </div>
                                <div class="selectBox pr fl">
 
                                </div>
                            </div>
                            <span class="error" id="Span2" style="float: left;">Please select area</span><span
                                class="ok">ok</span>
                        </td>
                    </tr> </table> -->
                                    </div>
                                </div>
                            </div>
                        </div>  
                        
  <div class="pull-right" style="padding-top:20px;font: 15px;">
 <button type="button" class="btn-u btn-u-red rounded" onclick="Loading(true);OrderConfirmation()">
                                            Next</button>
</div>                            
                    </section>
                    
             



                   
                </div>
            </form>
        </div>  
    
    
      </div><!--/end container-->
    </div>
    <!--=== End Content Medium Part ===-->     


<script type="text/javascript" src="/plugins/sky-forms/version-2.0.1/js/jquery.validate.min.js"></script>
<!-- Master Slider -->
<script type="text/javascript" src="/plugins/master-slider/quick-start/masterslider/masterslider.min.js"></script>
<script src="/plugins/master-slider/quick-start/masterslider/jquery.easing.min.js"></script>
<!-- Scrollbar -->
<script src="/plugins/scrollbar/src/jquery.mousewheel.js"></script>
<script src="/plugins/scrollbar/src/perfect-scrollbar.js"></script>
<script src="/plugins/jquery.parallax.js"></script>

<!-- JS Customization -->
<script src="/js/custom.js"></script>
<!-- JS Page Level -->
<script src="/js/shop.app.js"></script>
<script src="/js/forms/product-quantity.js"></script>
<script type="text/javascript" src="/js/plugins/style-switcher.js"></script>
<script>
    jQuery(document).ready(function () {
        App.init();
        StyleSwitcher.initStyleSwitcher();

    });

    function OrderConfirmation() {
        //data validattion
        //window.location.href = "/Product/CheckoutConfirmation.aspx";
        if ($("#cbFillBilling").is(':checked')) {
            //Do not need to verify billing address
        } else {
            if ($("#billing_firstname").val().length < 1) {
                $("#billing_firstname").focus();
                $("#billing_firstname").addClass("invalid");
                $("#billing_firstname").placeholder("Please Enter Firstname");
                Loading(false);
                return;
            }
            if ($("#billing_lastname").val().length < 1) {
                $("#billing_lastname").focus();
                $("#billing_lastname").addClass("invalid");
                Loading(false);
                //$("#billing_firstname").placeholder("Please Enter Firstname");
                return;
            }
            if ($("#billing_email").val().length < 1) {
                $("#billing_email").focus();
                $("#billing_email").addClass("invalid");
                Loading(false);
                //$("#billing_firstname").placeholder("Please Enter Firstname");
                return;
            }
            if ($("#billing_phone").val().length < 1) {
                $("#billing_phone").focus();
                $("#billing_phone").addClass("invalid");
                Loading(false);
                //$("#billing_firstname").placeholder("Please Enter Firstname");
                return;
            }
            if ($("#billing_address1").val().length < 1) {
                $("#billing_address1").focus();
                $("#billing_address1").addClass("invalid");
                Loading(false);
                //$("#billing_firstname").placeholder("Please Enter Firstname");
                return;
            }
            if ($("#billing_zip").val().length < 1) {
                $("#billing_zip").focus();
                $("#billing_zip").addClass("invalid");
                Loading(false);
                //$("#billing_firstname").placeholder("Please Enter Firstname");
                return;
            }
            if ($("#billing_city").val().length < 1) {
                $("#billing_city").focus();
                $("#billing_city").addClass("invalid");
                Loading(false);
                //$("#billing_firstname").placeholder("Please Enter Firstname");
                return;
            }
        }
        $("#frmCheckoutShipping").submit();
    }
    //$('#inputId').prop('readonly', true);
    function Fill_BillingAddress() {

        if ($("#cbFillBilling").is(':checked')) {
            //Fill Billing Address


            $("#billing_firstname").val($("#hid_fistname").val());
            $("#billing_lastname").val($("#hid_lastname").val());
            $("#billing_firstname").prop('readonly', true);
            $("#billing_lastname").prop('readonly', true);


            $("#billing_email").val($("#hid_email").val());
            $("#billing_email").prop('readonly', true);

            $("#billing_phone").val($("#hid_phone").val());
            $("#billing_phone").prop('readonly', true);

            $("#billing_address1").val($("#hid_address1").val());
            $("#billing_address1").prop('readonly', true);

            $("#billing_address2").val($("#hid_address2").val());
            $("#billing_address2").prop('readonly', true);


            $("#billing_zip").val($("#hid_addrZip").val());
            $("#billing_zip").prop('readonly', true);

            $("#billing_city").val($("#hid_addrCity").val());
            $("#billing_city").prop('readonly', true);

            var countryID=$("#hid_countryID").val();
            var sateID=$("#hid_stateID").val();

            $("#billing_country option[value=" + countryID + "]").attr("selected", "true"); //国家
            BindBillingProvince(countryID, sateID); //加载城市列表

        } else {
            // unchecked
            $("#billing_firstname").val("");
            $("#billing_lastname").val("");
            $("#billing_firstname").removeAttr('readonly');
            $("#billing_lastname").removeAttr('readonly');


            $("#billing_email").val("");
            $("#billing_email").removeAttr('readonly');

            $("#billing_phone").val("");
            $("#billing_phone").removeAttr('readonly');

            $("#billing_address1").val("");
            $("#billing_address1").removeAttr('readonly');

            $("#billing_address2").val("");
            $("#billing_address2").removeAttr('readonly');


            $("#billing_zip").val("");
            $("#billing_zip").removeAttr('readonly');

            $("#billing_city").val("");
            $("#billing_city").removeAttr('readonly');
        }
    }
</script>
<!--[if lt IE 9]>
    <script src="plugins/respond.js"></script>
    <script src="plugins/html5shiv.js"></script>
    <script src="js/plugins/placeholder-IE-fixes.js"></script>
<![endif]-->

<script type="text/javascript">


    function SaveDeliveryAddress() {
        var guid = $("#hidAddressId").val();
        if (guid == null || guid == "") {
            AddShipAddress();
        }
        else {
            UpdateShipAddress(guid);
        }

    }


    $(".show-all-address").find("li").mouseenter(function (event) {
        $(this).addClass('on')
    }).mouseleave(function (event) {
        $(this).removeClass('on')
    });

    //物流选择 
    $(".select-wuliu .showUl").click(function (event) {
        $(this).siblings('ul').show();
    });

    $(".select-wuliu").mouseleave(function (event) {
        $(this).find("ul").hide();
    });



    //增加地址
    $(".add-new-address > a").click(function (event) {
        $(".greybox,.add-new-address-box").show();
        $(".add-new-address-box").find('h2').text("Add delivery address")
        $("#btnSave").unbind("click")
        $("#btnSave").bind("click", function () { AddAddress() });
        ClearForm();
        return false;
    });

    //编辑收货地址
    $(".change-address-btn").click(function (event) {
        $(".add-new-address-box").find('h2').text("Edit delivery address")
        $(".greybox,.add-new-address-box").show();
        return false;
    });

    function GoBack() {
        window.location.href = "../Product/shopCart.aspx";
    }
    function AddShipAddress() {

        var flag = "true";
        var countyid = $("#selectCountry  option:selected").val();
        var provinceid = $("#selectProvince  option:selected").val();
        if (provinceid == -1) {
            alert("Please choose a State / Province");
            return;
        }
        var cityid = ""; // $("#selectCity  option:selected").val();
        var city = $("#txtShipCity").val(); //城市
        var zip = $("#txtShipZip").val(); //
        var address = $("#txtShipAddress").val();
        var address2 = $("#txtShipAddress2").val();
        var username = $("#txtShipName").val().trim();
        var lastName = $("#txtShipLastName").val(); //姓氏
        var phone = $("#txtShipPhone").val();
        var tel = $("#txtShipPhone").val();
        var email = $("#txtShipEmail").val();
        var isfirst = 1;
        //if ($("#ckbDefault").is(":checked")) {isfirst = 1;}
        if ($("#txtShipName").val().length < 1) {
            $("#txtShipName").focus();
            $("#txtShipName").addClass("invalid");
            $("#txtShipName").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipLastName").val().length < 1) {
            $("#txtShipLastName").focus();
            $("#txtShipLastName").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipEmail").val().length < 1) {
            $("#txtShipEmail").focus();
            $("#txtShipEmail").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipPhone").val().length < 1) {
            $("#txtShipPhone").focus();
            $("#txtShipPhone").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipAddress").val().length < 1) {
            $("#txtShipAddress").focus();
            $("#txtShipAddress").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipZip").val().length < 1) {
            $("#txtShipZip").focus();
            $("#txtShipZip").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipCity").val().length < 1) {
            $("#txtShipCity").focus();
            $("#txtShipCity").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        var bAddressOK = CheckAddress(address);
        var bAddress2OK = CheckAddress(address2);
        if (!bAddressOK || !bAddress2OK) {
            alert("We cannot deliver to a PO Box.\nPlease change your delivery address!");
            if (!bAddressOK) $("#txtAddress").focus();
            else $("#txtAddress2").focus();
        }
        /*
        if (username == "" || username.length < 2) { $("#errorNmae").show(); flag = "false"; } else { $("#errorNmae").hide(); }
        if (lastName == "") { $("#errorlastName").show(); flag = "false"; } else { $("#errorlastName").hide(); }
        if (city == "") { $("#errorCity").show(); flag = "false"; } else { $("#errorCity").hide(); }
        if (zip == "") { $("#errorZip").show(); flag = "false"; } else { $("#errorZip").hide(); }
        if (address == "" || !bAddressOK || !bAddress2OK) { $("#errorAddress").show(); flag = "false"; } else { $("#errorAddress").hide(); }
        if (phone == "") { $("#errorPhone").show(); flag = "false"; } else { $("#errorPhone").hide(); }
        if (provinceid == "-1") { $("#errorArea").show(); flag = "false"; } else { $("#errorArea").hide(); }
        if (flag == "false") {
            return;
        }*/
        var _data = "{ action:'add"
                    + "',countyid:'" + countyid
                    + "',provinceid:'" + provinceid
                    + "',cityid:'" + cityid
                    + "',city:'" + city
                    + "',zip:'" + zip
                    + "',address:'" + address
                    + "',address2:'" + address2
                    + "',username:'" + username
                    + "',lastName:'" + lastName
                    + "',phone:'" + phone
                    + "',tel:'" + tel
                    + "',email:'" + email
                    + "',isfirst:'" + isfirst + "'}";
        $.ajax({
            type: "Post",
            url: '../AjaxPages/userAddressAjax.aspx',
            data: _data,
            async: false,
            success: function (resu) {
                if (resu == "-1") {
                    alert("Please log in！");
                    return;
                }
                else if (resu == "0") {
                    alert("Failed to add！");
                    return;
                }
                else {
                    alert("Added successfully！");
                    //$(".greybox,.add-new-address-box").hide();
                    LoadShopaddress();

                    // after adding address need to re-load the check cart because the counry and Zip will affect the shippping fee
                   // LoadCheckCart();

                    //ClearForm();
                    //EnableGotoPayButton();
                    return;
                }
            }
        });
    }
    function UpdateShipAddress(guid) {
        var flag = "true";
        var countyid = $("#selectCountry  option:selected").val();
        var provinceid = $("#selectProvince  option:selected").val();
        if (provinceid == -1) {
            alert("Please choose a State / Province");
            return;
        }
        var cityid = null; //  $("#selectCity  option:selected").val();
        var city = $("#txtShipCity").val(); //城市
        var zip = $("#txtShipZip").val();
        var address = $("#txtShipAddress").val();
        var address2 = $("#txtShipAddress2").val();
        var username = $("#txtShipName").val().trim();
        var lastName = $("#txtShipLastName").val(); //姓氏
        var tel = $("#txtShipPhone").val();
        var phone = $("#txtShipPhone").val();
        var email = $("#txtShipEmail").val();
        var isfirst = 1;
        //if ($("#ckbDefault").is(":checked")) { isfirst = 1;} else { isfirst = 0;}       
        //if (cityid == "-1" || cityid == "") { $("#errorArea").show(); }

        if ($("#txtShipName").val().length < 1) {
            $("#txtShipName").focus();
            $("#txtShipName").addClass("invalid");
            $("#txtShipName").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipLastName").val().length < 1) {
            $("#txtShipLastName").focus();
            $("#txtShipLastName").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipEmail").val().length < 1) {
            $("#txtShipEmail").focus();
            $("#txtShipEmail").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipPhone").val().length < 1) {
            $("#txtShipPhone").focus();
            $("#txtShipPhone").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipAddress").val().length < 1) {
            $("#txtShipAddress").focus();
            $("#txtShipAddress").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipZip").val().length < 1) {
            $("#txtShipZip").focus();
            $("#txtShipZip").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        if ($("#txtShipCity").val().length < 1) {
            $("#txtShipCity").focus();
            $("#txtShipCity").addClass("invalid");
            //$("#txtShipfirstname").placeholder("Please Enter Firstname");
            return;
        }
        var bAddressOK = CheckAddress(address);
        var bAddress2OK = CheckAddress(address2);
        if (!bAddressOK || !bAddress2OK) {
            alert("We cannot deliver to a PO Box.\nPlease change your delivery address!");
            if (!bAddressOK) $("#txtShipAddress").focus();
            else $("#txtShipAddress2").focus();
        }
        /*
        if (city == "") { $("#errorCity").show(); flag = "false"; } else { $("#errorCity").hide(); }
        if (zip == "") { $("#errorZip").show(); flag = "false"; } else { $("#errorZip").hide(); }
        if (address == "" || !bAddressOK || !bAddress2OK) { $("#errorAddress").show(); flag = "false"; } else { $("#errorAddress").hide(); }
        if (username == "" || username.length < 2) { $("#errorNmae").show(); flag = "false"; } else { $("#errorNmae").hide(); }
        if (lastName == "") { $("#errorlastName").show(); flag = "false"; } else { $("#errorlastName").hide(); }
        if (phone == "") { $("#errorPhone").show(); flag = "false"; } else { $("#errorPhone").hide(); }
        if (provinceid == "-1") { $("#errorArea").show(); flag = "false"; } else { $("#errorArea").hide(); }
        if (flag == "false") {
            return;
        }*/
        var _data = "{ action:'update"
                    + "',guid:'" + guid
                    + "',countyid:'" + countyid
                    + "',provinceid:'" + provinceid
                    + "',cityid:'" + cityid
                    + "',city:'" + city
                    + "',zip:'" + zip
                    + "',address:'" + address
                    + "',address2:'" + address2
                    + "',username:'" + username
                    + "',lastName:'" + lastName
                    + "',phone:'" + phone
                    + "',tel:'" + tel
                    + "',email:'" + email
                    + "',isfirst:'" + isfirst + "'}";
        $.ajax({
            type: "Post",
            url: '/AjaxPages/userAddressAjax.aspx',
            data: _data,
            async: false,
            success: function (resu) {
                if (resu == "-1") {
                    //alert("Please login！");
                    return;
                }
                else if (resu == "0") {
                    alert("Modify the failure！");
                    return;
                }
                else {
                    alert("Successful modification！");
                    $(".greybox,.add-new-address-box").hide();
                    $("#ulAddress1").empty();
                    LoadShopaddress();

                    // after updating, need to re-load the check cart because the counry and Zip will affect the shippping fee
                    //LoadCheckCart();

                   // EnableGotoPayButton();
                    //ClearForm();
                    //window.location.href = window.location.href;
                    return;
                }
            }
        });
    }
    function CheckAddress(address) {
        // mantis #622 Either put a restriction so if system detects "PO Box" or "P.O. Box" in the ship address field it will create Error message
        //...OR put a bold warning that we cannot deliver to a PO Box.
        var addressLowerCase = address.toLowerCase();
        var patt = /(po|p.o.)\s{1,}(box)/g;
        var result = patt.test(addressLowerCase);
        return (!result);
    }
    </script>
   



</asp:Content>
